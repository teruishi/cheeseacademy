(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{1493:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"c",(function(){return o})),r.d(t,"b",(function(){return c}));var n={cv_before_purchasing:"cv-before-purchasing",cv_purchasing_process:"cv-purchasing-process",cv_purchase_completed:"cv-purchase-completed"};function o(e,t){e.trackActionLogs([e.buildActionLogRecord({kind:t.kind,contents:{action:t.action,content_key:(null==t?void 0:t.contentKey)||"",content_type:(null==t?void 0:t.contentType)||"",payment_type:(null==t?void 0:t.paymentType)||"",place_type:(null==t?void 0:t.placeType)||"",purchase_type:(null==t?void 0:t.purchaseType)||"",conversion_path:(null==t?void 0:t.prev)||"",experiment_info:(null==t?void 0:t.experiment_info)||{}}})])}function c(e){switch(e){case"urlname-n-key":case"n-key":return"note-detail";case"urlname":case"index":return"creator-top";case"urlname-magazines":case"magazines":return"creator-magazines";case"urlname-circle":case"circle":return"creator-circle";case"urlname-m-key":return"magazine-top";case"urlname-membership":case"membership":case"urlname-membership-boards":case"membership-boards":case"urlname-membership-boards-boardKey-posts-postKey":case"membership-boards-boardKey-posts-postKey":case"urlname-membership-notes":case"membership-notes":case"urlname-membership-magazines":case"membership-magazines":case"urlname-membership-info":case"membership-info":case"urlname-membership-members":case"membership-members":case"urlname-membership-join":case"membership-join":return"membership";default:return""}}},1526:function(e,t,r){"use strict";r(15);var n=r(31),o=r(21),c={computed:Object.assign(Object.assign({},Object(n.c)({expPurchaseConfirmButtonGroup:o.USER_GETTER_TYPES.EXPERIMENT_PURCHASE_CONFIRM_BUTTON_GROUP})),{note(){var e;return null===(e=this.$store.purchase)||void 0===e?void 0:e.note},isProCreator(){var e,t;return Boolean(null===(t=null===(e=this.note)||void 0===e?void 0:e.user)||void 0===t?void 0:t.proUserId)},purchaseConfirmButtonGroupName(){return this.isProCreator||!this.isLoggedIn?"others":this.expPurchaseConfirmButtonGroup},isPurchaseConfirmButtonTreatment(){return"treatment"===this.purchaseConfirmButtonGroupName}})};t.a=c},1736:function(e,t,r){"use strict";var n=r(0),o=(r(29),r(10),r(11),r(115),r(24),r(15),r(7)),c=r(584),d=r(585),l=r(227),m=r(591),h=r(310),_=r(188),v=r(54),f=r(573),y=r(9),T=["au","docomo","softbank","monthly_au","monthly_docomo","monthly_softbank"];t.a={computed:{note(){return this.$store.state.purchase.note},magazine(){return this.$store.state.purchase.magazine},circlePlan(){return this.$store.state.purchase.circlePlan},creator(){return this.$store.state.purchase.creator},premiumPlan(){return this.$store.state.modal.purchaseModalContainer.premiumPlan},actionType(){return this.$store.state.modal.purchaseModalContainer.actionType},nextRouteQuery(){return["circle_plan","membership_plan"].includes(this.actionType)?{at:this.actionType,k:this.contentKey,creator:this.creator.urlname,prev:this.$prevRoute.query.prev}:{at:this.actionType,k:this.contentKey}},contentKey(){switch(this.actionType){case"note_purchase":case"support":return this.note.key;case"magazine_purchase":case"magazine_subscribe":return this.magazine.key;case"circle_plan":case"membership_plan":return this.circlePlan.key;default:return""}},contentPath(){return this.note?this.$path.contentPath({contentType:"note",content:this.note}):this.magazine?this.$path.contentPath({contentType:"magazine",content:this.magazine}):this.circlePlan?this.$path.contentPath({contentType:"circle",content:this.circlePlan.circle.owner}):"/"}},methods:{afterPurchase(e){var{paymentMethod:t,purchaseResponse:r,nextRoute:n}=e;if([...T,"paypay"].includes(t)){var{startUrl:o,accessId:c,token:d}=r,form=document.createElement("form");form.action=o,form.method="post";var l=document.createElement("input");l.type="hidden",l.name="AccessID",l.value=c,form.appendChild(l);var m=document.createElement("input");m.type="hidden",m.name="Token",m.value=d,form.appendChild(m),document.body.appendChild(form),form.submit()}else{if("creditcard"===t&&void 0!==r){var{acs:h,redirectUrl:_}=r;if(2==h&&_.startsWith(y.gmo.creditCardWithTds.url))return void(window.location.href=_)}if("premium_subscribe"===this.actionType)return void this.replaceAfterPurchaseMessageModal({creatorImage:null,creatorMessage:null});if("replace"===(null==n?void 0:n.method))this.$router.replace({path:"/a/purchase/after_purchase",query:n.query});else{var content=["note_purchase","support"].includes(this.actionType)?this.note:this.magazine,{creatorImage:v,creatorMessage:C}=Object(f.a)(this.actionType,content);this.replaceAfterPurchaseMessageModal({creatorImage:v,creatorMessage:C})}}},confirm(e){var{paymentMethod:t}=e;this.replacePurchaseConfirmModal({paymentMethod:t})},savedCreditCard(e){var{paymentMethod:t,via:r,nextRoute:n}=e;if("magazine_subscribe"!==this.actionType)if("membership_plan"!==this.actionType){if("premium_subscribe"===this.actionType)return null==n||n.method,void this.replacePurchaseSubscribePremiumModal(this.premiumPlan);if("support"!==this.actionType){var o={actionType:this.actionType,paymentMethod:t,via:r};"replace"===(null==n?void 0:n.method)?this.replacePurchaseOneshotContentModal(Object.assign(Object.assign({},o),{nextRoute:n})):this.replacePurchaseOneshotContentModal(o)}else"replace"===(null==n?void 0:n.method)?this.replacePurchaseConfirmModal({paymentMethod:t,nextRoute:n}):this.replacePurchaseConfirmModal({paymentMethod:t})}else this.replaceSubscribeMembershipPlanModal({nextRoute:n});else"replace"===(null==n?void 0:n.method)?this.replacePurchaseSubscribeMagazineModal({via:r,nextRoute:n}):this.replacePurchaseSubscribeMagazineModal({via:r})},closedAfterPurchaseMessage(){var e=this;return Object(n.a)((function*(){switch(e.actionType){case"note_purchase":e.note&&(yield e.afterPurchaseFromNote(e.note));break;case"magazine_purchase":case"magazine_subscribe":if("note-detail"===e.$store.state.purchase.beforePurchasingPlace){var t=e.$store.state.pages.noteDetail.data;if(t)return yield e.afterPurchaseFromNote(t),void e.$store.dispatch(_.PURCHASE_ACTION_TYPES.SET_BEFORE_PURCHASING_PLACE,"")}if(e.magazine){yield e.$store.dispatch(h.MAGAZINE_TOP_ACTION_TYPES.GET_MAGAZINE_LAYOUT,{key:e.magazine.key});var r=e.$store.state.pages.magazineTop.magazineLayout,n=e.$path.contentPath({contentType:"magazine",content:r});e.$router.push({path:n})}break;case"support":yield e.$store.dispatch(o.NOTE_DETAIL_ACTION_TYPES.GET,{key:e.note.key});break;case"premium_subscribe":window.location.reload()}}))()},afterGuestPurchase(e){var{purchaseResult:t}=e;this.replacePurchaseNoteGuestCompleteModal({guestAuthorizationNumber:t.authorizationNumber})},moveToContentPath(){window.location.href=this.contentPath},afterPurchaseFromNote(e){var t=this;return Object(n.a)((function*(){var path=t.$path.customDomain?"/n/".concat(e.key):"/".concat(e.user.urlname,"/n/").concat(e.key);t.$router.push({path:path}),yield t.$store.dispatch(o.NOTE_DETAIL_ACTION_TYPES.GET,{key:e.key}),"TextNote"===e.type&&(yield t.$store.dispatch(o.NOTE_DETAIL_ACTION_TYPES.SANITIZE_TEXT_NOTE_BODY,t.$store.getters[v.URL_GETTER_TYPES.GET_CURRENT_HEAD_URL])),t.$store.dispatch(c.HOME_TIMELINE_ACTION_TYPES.MODIFY_ARTICLE,t.$store.state.pages.noteDetail.data),t.$store.dispatch(d.CATEGORY_TIMELINE_ACTION_TYPES.MODIFY_ARTICLE,t.$store.state.pages.noteDetail.data),t.$store.dispatch(l.HASHTAG_TIMELINE_ACTION_TYPES.MODIFY_ARTICLE,t.$store.state.pages.noteDetail.data),t.$store.dispatch(m.LIBRARY_TIMELINE_ACTION_TYPES.MODIFY_ARTICLE,t.$store.state.pages.noteDetail.data)}))()}}}},2098:function(e,t,r){var n=r(52);e.exports=function(e,t){var r=n(e),o=n(t);return r.getTime()>o.getTime()}},2884:function(e,t,r){"use strict";var n=r(0),o=(r(24),r(68),r(32),r(15),r(3)),c=r(53),d=r(232),l=r.n(d),m=r(56),h=r.n(m),_=r(2098),v=r.n(_),f=r(3612),y=r(80),T=r(114),C=r(116),x=r(34),$=r(78),E=r(9),M=r(188),I=r(21),P=r(365),k=r(98),A=r(3078),z=r(101),R=r(355),S=r(30),w=r(1424),O=r(1493),N=r(1526),L=()=>({mail:"",card:{no:"",cvc:"",expiryMonth:h()(new Date,"MM"),expiryYear:Object(P.a)(),name:""},isSubmitting:!1,errored:null,errorMessage:""}),D=o.a.extend({components:{CreditCardForm:f.a,FormErrorList:y.a,FormInput:T.a,ModalHeading:C.a,NtButton:x.a,NtLinkFunctional:$.a},mixins:[S.a,R.a,w.a,N.a],props:{isModal:{type:Boolean,default:!1},placeType:{type:String,default:"purchase-credit-card-input-modal"}},data:()=>L(),validations(){var e={card:{no:{required:c.required,length:e=>14<=(e=e.replace(/-/g,"")).length&&e.length<=16,pattern:e=>(e=e.replace(/-/g,""),RegExp("^[0-9]+$").test(e))},cvc:{required:c.required,length:e=>3<=e.length&&e.length<=4},name:{required:c.required,pattern:e=>RegExp("^[A-Z.,-/ ]+$").test(e)}}};return this.isLoggedIn||(e.mail={required:c.required,pattern:e=>/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(e)}),e},computed:{hasValidationResult(){return this.isLoggedIn?this.$v&&this.$v.card:this.$v&&this.$v.card&&this.$v.mail},isAsukaTarget(){return this.$store.getters[I.USER_GETTER_TYPES.IS_ASUKA_TARGET]},price(){switch(this.$store.state.modal.purchaseModalContainer.actionType){case"note_purchase":return this.$store.state.purchase.note.price;case"magazine_purchase":case"magazine_subscribe":return this.$store.state.purchase.magazine.price;case"membership_plan":return this.$store.state.purchase.circlePlan.price;case"support":return this.$store.state.modal.purchaseModalContainer.supportPrice;default:return 0}},contentName(){switch(this.$store.state.modal.purchaseModalContainer.actionType){case"note_purchase":case"support":return this.$store.state.purchase.note.name;case"magazine_purchase":case"magazine_subscribe":return this.$store.state.purchase.magazine.name;case"membership_plan":return this.$store.state.purchase.circlePlan.name;default:return""}},categories(){switch(this.$store.state.modal.purchaseModalContainer.actionType){case"note_purchase":case"support":return this.$store.state.purchase.note.categories.map((e=>e.name));default:return[]}},isErrorMessageExists(){return this.errorMessage.length>0},forwardButton(){return this.isSubmitting?{label:"処理中",props:{disabled:!0},clickListener:()=>{}}:this.isLoggedIn?{label:"保存",props:{disabled:this.$v.$anyError,type:"primary"},clickListener:this.saveCheck}:{label:"購入内容の確認",props:{disabled:this.$v.$anyError,type:"primary"},clickListener:this.confirmCheck}},headerText(){return this.isLoggedIn?"お支払い情報の入力":"会員登録せずに購入"}},mounted(){Object(O.c)(this.$tracker,{kind:O.a.cv_purchasing_process,action:"imp",placeType:this.placeType,experiment_info:{purchase_confirm_button:{group_name:this.purchaseConfirmButtonGroupName}}})},methods:{init(){Object(k.f)(E.gmo.tokenScript,!1),Object(A.b)(this.isAsukaTarget),Object.assign(this.$data,L());var{mail:e,card:t}=this.$store.state.purchase.guest;for(var r in Boolean(e)&&(this.mail=e),t)Boolean(t[r])&&(this.card[r]=t[r]);this.$nextTick((()=>{this.$refs.creditCardForm&&t.no&&(this.$refs.creditCardForm.splitCardNo=Object(z.c)(t.no))})),this.$v.$reset(),this.$forceUpdate()},saveCheck(){this.$v.$touch(),this.$v.$invalid||(this.errorMessage="",v()(new Date,l()(new Date(this.card.expiryYear,Number(this.card.expiryMonth)-1)))?this.errorMessage="クレジットカードの有効期限が過ぎています":(this.isSubmitting=!0,Object(A.a)(this.save,this.cancel,this.isAsukaTarget)))},save(){var e=this;return Object(n.a)((function*(){e.card.no=e.card.no.replace(/-/g,""),e.errored=null,yield e.$store.dispatch(I.USER_ACTION_TYPES.SAVE_CREDITCARD,e.card),e.isSubmitting=!1,e.$store.state.user.errored?e.errored=e.$store.state.user.errored:(e.$emit("saved",{paymentMethod:"creditcard",via:"creditCardInput"}),e.$_purchaseable_shouldShowCautionModal&&e.isModal&&e.replacePurchaseCautionModal({afterCaution:"confirm"}))}))()},confirmCheck(){this.$v.$touch(),this.$v.$invalid||Object(A.a)(this.confirm,this.cancel,this.isAsukaTarget)},confirm(){this.card.no=this.card.no.replace(/-/g,"");var e={mail:this.mail,card:this.card};this.$store.dispatch(M.PURCHASE_ACTION_TYPES.SET_GUEST,e),this.$emit("confirm")},cancel(){this.isSubmitting=!1,this.isLoggedIn?this.$store.dispatch(I.USER_ACTION_TYPES.RESET_CREDITCARD):this.$store.dispatch(M.PURCHASE_ACTION_TYPES.RESET_GUEST_CREDITCARD),this.$emit("close")}}}),B=(r(4083),r(4085),r(5)),component=Object(B.a)(D,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"m-cardInput"},[r("div",{staticClass:"m-basicModalContent__header",class:{"m-cardInput__headerTreatment":e.isPurchaseConfirmButtonTreatment}},[e.isModal?r("modal-heading",[e._v("\n      "+e._s(e.headerText)+"\n    ")]):[e._v("\n      "+e._s(e.headerText)+"\n    ")]],2),e._v(" "),r("div",{staticClass:"m-basicModalContent__body"},[e.hasValidationResult?r("div",{staticClass:"m-cardInput__body",class:{"mx-4":e.isPurchaseConfirmButtonTreatment}},[e.isLoggedIn?e._e():r("div",{staticClass:"m-cardInput__item"},[r("div",[r("h3",{staticClass:"m-cardInput__attentionTitle"},[e._v("\n            購入後にお送りするメール内で閲覧できます。\n          ")]),e._v(" "),r("p",{staticClass:"m-cardInput__attentionText"},[e._v("\n            ウェブやアプリで読みたい方や記事更新分も確認したい方は、\n            "),r("nt-link-functional",{staticClass:"m-cardInput__attentionLink",attrs:{href:e.$path.signupPath()}},[e._v("\n              会員登録\n            ")]),e._v("\n            または\n            "),r("nt-link-functional",{staticClass:"m-cardInput__attentionLink",attrs:{href:e.$path.loginPath()}},[e._v("\n              ログイン\n            ")]),e._v("\n            後に購入してください。\n          ")],1)])]),e._v(" "),r("section",{staticClass:"m-cardInput__item"},[r("h2",{staticClass:"visually-hidden"},[e._v("\n          カード情報を入力\n        ")]),e._v(" "),r("credit-card-form",{ref:"creditCardForm",attrs:{card:e.card,price:e.price,"content-name":e.contentName,categories:e.categories}})],1),e._v(" "),e.isLoggedIn?e._e():r("div",{staticClass:"m-cardInput__item"},[r("form-input",{attrs:{id:"mail",required:!0,"has-error":e.$v.mail.$error,type:"email",label:"メールアドレス",placeholder:"例: info@example.com"},on:{blur:function(t){return e.$v.mail.$touch()}},model:{value:e.mail,callback:function(t){e.mail="string"==typeof t?t.trim():t},expression:"mail"}},[e.$v.mail.$error?r("form-error-list",{attrs:{slot:"errorMessage"},slot:"errorMessage"},[e.$v.mail.required?e._e():r("div",[e._v("\n              メールアドレスは入力必須です。\n            ")]),e._v(" "),e.$v.mail.email?e._e():r("div",[e._v("\n              メールアドレスの形式が不正です。\n            ")])]):e._e()],1),e._v(" "),e._m(0)],1),e._v(" "),r("form-error-list",[e.errored?r("div",[e._v("\n          "+e._s(e.toApiErrorMessage(e.errored))+"\n        ")]):e._e(),e._v(" "),e.isErrorMessageExists?r("div",[e._v("\n          "+e._s(e.errorMessage)+"\n        ")]):e._e()])],1):e._e()]),e._v(" "),e.isPurchaseConfirmButtonTreatment?r("div",{staticClass:"m-cardInput__footerTreatment"},[r("nt-button",{attrs:{disabled:e.isSubmitting,size:"large",width:"fit",type:"primary"},on:{click:function(t){return t.preventDefault(),e.forwardButton.clickListener(t)}}},[e._v("\n      "+e._s(e.forwardButton.label)+"\n    ")]),e._v(" "),r("nt-button",{staticClass:"mt-3",attrs:{disabled:e.isSubmitting,width:"fit",type:"basic"},on:{click:function(t){return t.preventDefault(),e.cancel(t)}}},[e._v("\n      キャンセル\n    ")])],1):r("div",{staticClass:"m-basicModalContent__footer"},[r("div",{staticClass:"m-cardInput__footer"},[r("nt-button",{staticClass:"m-cardInput__footerButton",attrs:{disabled:e.isSubmitting,type:"basic",size:"small"},on:{click:function(t){return t.preventDefault(),e.cancel()}}},[e._v("\n        キャンセル\n      ")]),e._v(" "),r("nt-button",e._b({staticClass:"m-cardInput__footerButton",attrs:{size:"small"},on:{click:function(t){return t.preventDefault(),e.forwardButton.clickListener(t)}}},"nt-button",e.forwardButton.props,!1),[e._v("\n        "+e._s(e.forwardButton.label)+"\n      ")])],1)])])}),[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"m-cardInput__note"},[e._v("\n          ※記事の内容がこちらのメールアドレスに配信されます。入力間違いをするとお受け取りになれません。ご注意ください。"),r("br"),e._v("\n          ※携帯キャリアメール・iCloudメールはご指定いただけません。\n        ")])}],!1,null,"313bc9e0",null);t.a=component.exports},3168:function(e,t,r){var content=r(4084);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(13).default)("8f860adc",content,!0,{sourceMap:!1})},3169:function(e,t,r){var content=r(4086);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(13).default)("0e72086a",content,!0,{sourceMap:!1})},4083:function(e,t,r){"use strict";r(3168)},4084:function(e,t,r){var n=r(12)((function(i){return i[1]}));n.push([e.i,".m-basicModalContent[data-v-313bc9e0]{position:relative;margin:56px auto;background:var(--color-surface-normal);border-radius:4px}@media only screen and (max-width:480px){.m-basicModalContent[data-v-313bc9e0]{margin:8px auto 80px}}.m-basicModalContent__header[data-v-313bc9e0]:not(:empty){padding:16px;font-size:var(--font-size-base);color:var(--color-text-primary);text-align:center;border-bottom:1px solid var(--color-border-default)}@media only screen and (max-width:480px){.m-basicModalContent__body[data-v-313bc9e0]{width:100%}}.m-basicModalContent__body--height[data-v-313bc9e0]{max-height:440px}@media only screen and (max-width:480px){.m-basicModalContent__body--height[data-v-313bc9e0]{height:calc(100vh - 240px)}}.m-basicModalContent__body--scrollable[data-v-313bc9e0]{max-height:440px;overflow-y:auto}@media only screen and (max-width:480px){.m-basicModalContent__body--scrollable[data-v-313bc9e0]{max-height:calc(100vh - 240px)}}.m-basicModalContent__footer[data-v-313bc9e0]{display:flex;align-items:center;justify-content:center;padding:16px;background-color:var(--color-background-secondary);border-top:1px solid var(--color-border-default);border-radius:0 0 4px 4px}.m-basicModalContent--size_small[data-v-313bc9e0]{width:470px}@media only screen and (max-width:480px){.m-basicModalContent--size_small[data-v-313bc9e0]{width:calc(100% - 16px)}}.m-basicModalContent--size_medium[data-v-313bc9e0]{width:580px}@media only screen and (max-width:480px){.m-basicModalContent--size_medium[data-v-313bc9e0]{width:calc(100% - 16px)}}.m-basicModalContent--size_large[data-v-313bc9e0]{width:100%}@media only screen and (max-width:480px){.m-basicModalContent--size_large[data-v-313bc9e0]{width:calc(100% - 16px)}}",""]),n.locals={},e.exports=n},4085:function(e,t,r){"use strict";r(3169)},4086:function(e,t,r){var n=r(12)((function(i){return i[1]}));n.push([e.i,".m-cardInput__headerTreatment[data-v-313bc9e0]{padding-bottom:0!important;padding-left:8px!important;font-size:var(--font-size-xl)!important;font-weight:700;text-align:start!important;border-bottom:none!important}.m-cardInput__footerTreatment[data-v-313bc9e0]{display:flex;flex-direction:column;padding:16px 0}@media only screen and (max-width:480px){.m-cardInput__footerTreatment[data-v-313bc9e0]{position:fixed;bottom:0;left:0;z-index:1;width:100%;padding:16px 16px calc(16px + env(safe-area-inset-bottom))}}.m-cardInput__body[data-v-313bc9e0]{margin:24px}.m-cardInput__item+.m-cardInput__item[data-v-313bc9e0]{padding-top:24px;margin-top:24px;border-top:1px solid var(--color-border-default)}.m-cardInput__note[data-v-313bc9e0]{margin-top:24px;font-size:var(--font-size-sm);color:var(--color-text-secondary)}.m-cardInput__footer[data-v-313bc9e0]{display:flex;justify-content:flex-end;width:100%}.m-cardInput__footer>.m-cardInput__footerButton[data-v-313bc9e0]{margin-left:16px}.m-cardInput__attentionTitle[data-v-313bc9e0]{font-size:var(--font-size-sm)}.m-cardInput__attentionText[data-v-313bc9e0]{margin-top:8px;font-size:var(--font-size-xs);color:var(--color-text-secondary)}.m-cardInput__attentionLink[data-v-313bc9e0]{text-decoration:underline}",""]),n.locals={},e.exports=n}}]);